---
- name: Create ServiceNow Change Request
  hosts: localhost
  gather_facts: no
  vars:
    vm_names: "{{ group['web'] }}"

  tasks:

    - name: Display the ITSM update message from workflow
      ansible.builtin.debug:
        msg: |
          ITSM Update Summary:
          Mock post provisioning Terraform provisioning request for:
          {{ vm_names }} {{ catalogue_create_message | default('No update message provided') }}

          See examples in comments on github: https://github.com/mkbredem/aap_tfc_workshop/blob/main/servicenow_catalog_update.yml

### Generated by Ansible Lightspeed with Watson Code Assistant
#    - name: Create a change request in ServiceNow
#      servicenow.itsm.change_request:
#        instance: "{{ servicenow_instance }}"
#        user: "{{ servicenow_user }}"
#        password: "{{ servicenow_password }}"
#        state: implement
#        short_description: "{{ snow_short_description}}"
#        description: "{{ snow_description}}"
#        category: "{{ snow_category }}"
#        priority: "{{ snow_priority}}"
#        impact: "{{ snow_impact }}"
#      register: change_request

#    - name: Output change request details
#      ansible.builtin.debug:
#        msg: "Change Request created with number {{ change_request.number }}"

#    - name: Set ServiceNow CR number for downstream use
#      ansible.builtin.set_stats:
#        data:
#          servicenow_cr_number: "{{ change_request.number }}"
#        per_host: false